---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```

# FlowCodeUnmix

<!-- badges: start -->
<!-- badges: end -->

FlowCodeUnmix is intended to be a complete debarcoding and unmixing pipeline for spectral flow cytometry samples using the FlowCode protein epitope barcoding technology. Thi

FlowCodeUnmix is provided under an AGPL3 licence.

To read about FlowCodes see the [Immunity paper by Bricard et al.](https://www.cell.com/immunity/fulltext/S1074-7613(24)00277-2) and also the
[ProCode system](https://www.sciencedirect.com/science/article/pii/S0092867418312340?via%3Dihub) upon which FlowCodes are based.

## Installation

You will need to install the following packages:

* BiocManager
* flowCore
* FlowSOM
* flowWorkspace
* remotes (or devtools)
* AutoSpectral

Everything else should be installed automatically.

Run the code below on your machine to set everything up.

``` {r, eval = FALSE}
# Install Bioconductor packages
if (!requireNamespace("BiocManager", quietly = TRUE))
  install.packages("BiocManager")
BiocManager::install(c("flowWorkspace", "flowCore", "FlowSOM", "remotes"))

# You'll need devtools or remotes to install from GitHub.
remotes::install_github("DrCytometer/AutoSpectral")
remotes::install_github("DrCytometer/FlowCodeUnmix")
```

## Required inputs

You will need these pieces of information:

* Single-stained control samples, preferably cell-based
* A "backbone"" control sample stained with all the anti-epitope antibodies (and nothing else)
* Unstained control cells matching the source used in the backbone control
* Unstained control cells matching the source(s) in your fully stained samples
* A CSV file describing the valid combinations of epitope barcodes and what they correspond to. Example format below:
![Combination file](man/figures/README/Combo_file.jpg)


## Help

FlowCodeUnmix is based around AutoSpectral. Please see the [help pages and articles](https://drcytometer.github.io/AutoSpectral/) for AutoSpectral as a starting point. In particular, see the [AutoSpectral Full Workflow](https://drcytometer.github.io/AutoSpectral/articles/01_Full_AutoSpectral_Workflow.html).

For FlowCodeUnmix, see the example workflow in "FlowCode_Unmixing_Workflow.Rmd", which is also available on the web at [FlowCode Workflow](https://drcytometer.github.io/FlowCodeUnmix/articles/FlowCode_Unmixing_Workflow.html). You can view all of the functions available in FlowCodeUnmix [here](https://drcytometer.github.io/FlowCodeUnmix/reference/index.html).


## Examples

Here is what the unmixing looks like for the backbone control (FlowCode epitopes only) with standard OLS unmixing or using `FlowCodeUnmix`:
![Unmixing comparison](man/figures/README/FlowCodeUnmix_examples.jpg)

You get debarcoded channels in the output FCS file:
![Unmixing comparison](man/figures/README/Debarcoded_fcs.jpg)



